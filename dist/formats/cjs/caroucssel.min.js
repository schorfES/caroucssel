"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=new WeakMap;function e(e,s,n){const i=t.get(e)||{};if(s in i)return i[s];if(!n)return;const o=n();return i[s]=o,t.set(e,i),o}function s(e,s,n){const i=t.get(e)||{};i[s]=n,t.set(e,i)}function n(e,s){const n=t.get(e);n&&(n[s]=void 0,delete n[s])}function i(e){t.delete(e)}function o(t,e){const s=document.createElement("div");s.innerHTML=t(e);const n=s.firstElementChild;return n||null}const r={template:({className:t,controls:e,label:s,title:n})=>`\n\t\t<button type="button" class="${t}" aria-label="${s}" title="${n}" aria-controls="${e}">\n\t\t\t<span>${s}</span>\n\t\t</button>\n\t`,className:"button",nextClassName:"is-next",nextLabel:"Next",nextTitle:"Go to next",previousClassName:"is-previous",previousLabel:"Previous",previousTitle:"Go to previous"};var l,a;!function(t){t.SCROLL="scroll",t.RESIZE="resize",t.FORCED="forced",t.FEATURE="feature"}(l||(l={})),function(t){t.AUTO="auto",t.SMOOTH="smooth"}(a||(a={}));class c{constructor(){window.addEventListener("resize",(()=>{n(this,"dimensions")}))}get dimensions(){return e(this,"dimensions",(()=>{const t=document.createElement("div"),e=document.createElement("div");document.body.appendChild(e),e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.appendChild(t),t.style.width="200px",t.style.height="100%",e.style.width="150px",e.style.height="200px",e.style.overflow="hidden";const s=t.offsetHeight;e.style.overflow="scroll";let n=t.offsetHeight;n=s===n?e.clientHeight:n;const i=s-n;return document.body.removeChild(e),{height:i}}))}}let d;const h={enabled:!0,className:"caroucssel-mask",tagName:"div"};class u{constructor(t={}){s(this,"config",Object.assign(Object.assign({},h),t))}get name(){return"buildin:mask"}get el(){var t;return null!==(t=e(this,"mask"))&&void 0!==t?t:null}init(t){s(this,"proxy",t),d=d||new c,this._render()}destroy(){this._remove(),i(this)}update(t){switch(t.reason){case l.RESIZE:case l.FORCED:n(this,"scrollbar"),this._render();break;default:this._render()}}_render(){const{enabled:t,className:n,tagName:i}=e(this,"config");if(!t)return;const o=e(this,"proxy").el;let{height:r}=d.dimensions;o.scrollWidth<=o.clientWidth&&(r=0),e(this,"mask",(()=>{var t;const e=document.createElement(i);return e.className=n,e.style.overflow="hidden",e.style.height="100%",null===(t=o.parentNode)||void 0===t||t.insertBefore(e,o),e.appendChild(o),e}));r!==e(this,"scrollbar")&&(s(this,"scrollbar",r),o.style.height=`calc(100% + ${r}px)`,o.style.marginBottom=-1*r+"px")}_remove(){var t,s;const{el:n}=e(this,"proxy"),i=e(this,"mask");null===(t=null==i?void 0:i.parentNode)||void 0===t||t.insertBefore(n,i),null===(s=null==i?void 0:i.parentNode)||void 0===s||s.removeChild(i),n.removeAttribute("style")}}const p={template:({className:t,controls:e,pages:s,label:n,title:i})=>`\n\t\t<ul class="${t}">\n\t\t\t${s.map(((t,o)=>{const r={index:o,page:t,pages:s},l=n(r),a=i(r);return`<li>\n\t\t\t\t\t<button type="button" aria-controls="${e}" aria-label="${a}" title="${a}">\n\t\t\t\t\t\t<span>${l}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</li>`})).join("")}\n\t\t</ul>\n\t`,className:"pagination",label:({index:t})=>`${t+1}`,title:({index:t})=>`Go to ${t+1}. page`};function g(t){return e(t,"instance")}class m{constructor(t,e){s(this,"instance",t),s(this,"features",e)}get id(){return g(this).id}get el(){return g(this).el}get mask(){return g(this).mask}get index(){return g(this).index}set index(t){g(this).index=t}get items(){return g(this).items}get pages(){return g(this).pages}get pageIndex(){return g(this).pageIndex}update(t){var s;g(this).update(),(s=this,e(s,"features")).forEach((e=>{e!==t&&e.update({reason:l.FEATURE})}))}}function f(t,e){let s=null;return(...n)=>{null!==s&&clearTimeout(s),s=setTimeout((()=>t(...n)),e)}}const v=/^caroucssel-[0-9]*$/,x=/^(link|meta|noscript|script|style|title)$/i,b={features:[],filterItem:()=>!0,onScroll:()=>{}};let y=0;exports.Buttons=class{constructor(t={}){s(this,"config",Object.assign(Object.assign({},r),t)),this._onPrevious=this._onPrevious.bind(this),this._onNext=this._onNext.bind(this)}get name(){return"buildin:buttons"}init(t){s(this,"proxy",t),this._render()}destroy(){this._remove(),i(this)}update(){this._render()}_render(){const t=e(this,"proxy"),s=e(this,"config"),{el:n,mask:i,pages:r,pageIndex:l}=t,a=null!=i?i:n,{template:c,className:d,previousClassName:h,previousLabel:u,previousTitle:p,nextClassName:g,nextLabel:m,nextTitle:f}=s,v=[{controls:n.id,label:m,title:f,className:[d,g].join(" "),handler:this._onNext},{controls:n.id,label:u,title:p,className:[d,h].join(" "),handler:this._onPrevious}],[x,b]=e(this,"buttons",(()=>v.map((t=>{var e,{handler:s}=t,n=function(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(s[n[i]]=t[n[i]])}return s}(t,["handler"]);const i=o(c,n);return i?(i.addEventListener("click",s),null===(e=a.parentNode)||void 0===e||e.insertBefore(i,a.nextSibling),i):null}))));if(x){const t=void 0===r[l+1];x.disabled=t}if(b){const t=void 0===r[l-1];b.disabled=t}}_remove(){e(this,"buttons").forEach((t=>{var e;null==t||t.removeEventListener("click",this._onPrevious),null==t||t.removeEventListener("click",this._onNext),null===(e=null==t?void 0:t.parentNode)||void 0===e||e.removeChild(t)}))}_onPrevious(){const t=e(this,"proxy"),{pages:s,pageIndex:n}=t,i=s[n-1]||s[0];t.index=i}_onNext(){const t=e(this,"proxy"),{pages:s,pageIndex:n}=t,i=s[n+1]||s[s.length-1];t.index=i}},exports.Carousel=class{constructor(t,e={}){if(this.behavior=a.AUTO,!(t&&t instanceof Element))throw new Error(`Carousel needs a dom element but "${typeof t}" was passed.`);s(this,"element",t),y++,t.id=t.id||`caroucssel-${y}`,s(this,"id",t.id);const n=Object.assign(Object.assign({},b),e);s(this,"config",n);let i=null,o=[...n.features];const r=n.features.findIndex((t=>t instanceof u));r>-1&&([i]=o.splice(r,1)),null!=i||(i=new u),o=o.filter((t=>!(t instanceof u))),o=[i,...o],s(this,"mask",i);const l=new m(this,o);switch(s(this,"proxy",l),s(this,"feautres",o),o.forEach((t=>t.init(l))),!0){case Array.isArray(e.index):this.index=e.index;break;case!isNaN(e.index):this.index=[e.index]}this.behavior=a.SMOOTH,this._onScroll=f(this._onScroll.bind(this),25),this._onResize=f(this._onResize.bind(this),25),t.addEventListener("scroll",this._onScroll),window.addEventListener("resize",this._onResize)}static resetInstanceCount(){}get el(){return e(this,"element")}get mask(){var t;return null!==(t=e(this,"mask").el)&&void 0!==t?t:null}get id(){return e(this,"id")}get index(){return e(this,"index",(()=>{const{el:t,items:e}=this,{length:s}=e,{clientWidth:n}=t,i=t.getBoundingClientRect().left,o=[];let r=0;for(;r<s;r++){const t=e[r].getBoundingClientRect(),{width:s}=t;let{left:l}=t;l-=i,l+.25*s>=0&&l+.75*s<=n&&o.push(r)}return 0===o.length?[0]:o}))}set index(t){const{behavior:e,el:s,items:i}=this,{length:o}=i;if(!Array.isArray(t)||!t.length)return;let r=t[0]||0;r=Math.max(Math.min(r,o-1),0);const{scrollLeft:l}=s,a=l,c={left:i[r].offsetLeft};r===this.pages[0][0]&&(c.left=0),a!==c.left&&(n(this,"index"),s.scrollTo(Object.assign(Object.assign({},c),{behavior:e})))}get items(){return e(this,"items",(()=>{const{filterItem:t}=e(this,"config"),{el:s}=this;return Array.from(s.children).filter((t=>!x.test(t.tagName)&&!t.hidden)).filter(t)}))}get pages(){return e(this,"pages",(()=>{const{el:t,items:e}=this,{clientWidth:s}=t;if(0===s)return e.map(((t,e)=>[e]));let n=[[]];return e.map(((t,e)=>{const{offsetLeft:s,clientWidth:n}=t;return{left:s,width:n,item:t,index:e}})).sort(((t,e)=>t.left-e.left)).forEach((t=>{const{left:e,width:i}=t,o=n[n.length-1],r=o[0];let l=(null==r?void 0:r.left)||0;o===n[0]&&(l=0);let a=Math.floor((e-l+.75*i)/s);for(;a>0;)n.push([]),a--;n[n.length-1].push(t)})),n=n.filter((t=>0!==t.length)),n.map((t=>t.map((({index:t})=>t))))}))}get pageIndex(){return e(this,"page-index",(()=>{const{el:t,items:e,index:s,pages:n}=this,i=t.getBoundingClientRect().left,{clientWidth:o}=t;let r=s.reduce(((t,s)=>{if(!e[s])return t;let{left:n,right:r}=e[s].getBoundingClientRect();return n=Math.round(n-i),r=Math.round(r-i),n<0||o<r?t:t.concat([s])}),[]);0===r.length&&(r=[s[0]]);const l=r.sort(((t,s)=>{const n=e[t].getBoundingClientRect().right;return e[s].getBoundingClientRect().right-n}))[0];return n.findIndex((t=>t.includes(l)))}))}destroy(){const{el:t}=this;v.test(t.id)&&t.removeAttribute("id");e(this,"feautres").forEach((t=>t.destroy())),t.removeEventListener("scroll",this._onScroll),window.removeEventListener("resize",this._onResize),i(this)}update(){n(this,"index"),n(this,"items"),n(this,"pages"),n(this,"page-index");e(this,"feautres").forEach((t=>t.update({reason:l.FORCED})))}_onScroll(t){n(this,"index"),n(this,"page-index");e(this,"feautres").forEach((t=>t.update({reason:l.SCROLL})));const{index:s}=this;e(this,"config").onScroll({index:s,type:"scroll",target:this,originalEvent:t})}_onResize(){n(this,"pages"),n(this,"index"),n(this,"page-index");e(this,"feautres").forEach((t=>t.update({reason:l.RESIZE})))}},exports.Mask=u,exports.Mouse=class{get name(){return"buildin:mouse"}init(t){s(this,"proxy",t)}destroy(){console.log("Destroy mouse")}update(t){console.log("Update mouse:",t.reason)}},exports.Pagination=class{constructor(t={}){s(this,"config",Object.assign(Object.assign({},p),t)),this._onClick=this._onClick.bind(this)}get name(){return"buildin:pagination"}init(t){s(this,"proxy",t),this._add()}destroy(){this._remove(),i(this)}update(t){switch(t.reason){case l.SCROLL:this._update();break;default:this._remove(),this._add()}}_add(){var t;const n=e(this,"proxy"),i=e(this,"config"),{el:r,mask:l,pages:a}=n,c=null!=l?l:r;if(a.length<2)return;const{template:d,className:h,label:u,title:p}=i,g=o(d,{label:u,title:p,pages:a,className:h,controls:r.id});if(!g)return;const m=Array.from(g.querySelectorAll("button")).map((t=>(t.addEventListener("click",this._onClick,!0),t)));null===(t=c.parentNode)||void 0===t||t.appendChild(g),s(this,"pagination",g),s(this,"buttons",m),this._update()}_update(){const t=e(this,"proxy"),s=e(this,"buttons"),{pageIndex:n}=t;s.forEach(((t,e)=>t.disabled=e===n))}_remove(){var t;const s=e(this,"pagination"),i=e(this,"buttons");null==i||i.forEach((t=>{var e;t.removeEventListener("click",this._onClick),null===(e=t.parentNode)||void 0===e||e.removeChild(t)})),null===(t=null==s?void 0:s.parentNode)||void 0===t||t.removeChild(s),n(this,"buttons"),n(this,"pagination")}_onClick(t){const s=e(this,"proxy"),n=e(this,"buttons"),i=t.currentTarget,o=n.indexOf(i);s.index=s.pages[o]}},exports.version="0.12.0-2";
