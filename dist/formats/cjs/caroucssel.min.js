"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=new WeakMap;function e(e,n,s){const i=t.get(e)||{};if(n in i)return i[n];if(!s)return;const r=s();return i[n]=r,t.set(e,i),r}function n(e,n,s){const i=t.get(e)||{};i[n]=s,t.set(e,i)}function s(e,n){const s=t.get(e);s&&(s[n]=void 0,delete s[n])}function i(e){t.delete(e)}function r(t,e){const n=document.createElement("div");n.innerHTML=t(e);const s=n.firstElementChild;return s||null}const l={template:({className:t,controls:e,label:n,title:s})=>`\n\t\t<button type="button" class="${t}" aria-label="${n}" title="${s}" aria-controls="${e}">\n\t\t\t<span>${n}</span>\n\t\t</button>\n\t`,className:"button",nextClassName:"is-next",nextLabel:"Next",nextTitle:"Go to next",previousClassName:"is-previous",previousLabel:"Previous",previousTitle:"Go to previous"};var o,a;!function(t){t.SCROLL="scroll",t.RESIZE="resize",t.FORCED="forced",t.FEATURE="feature"}(o||(o={})),function(t){t.AUTO="auto",t.SMOOTH="smooth"}(a||(a={}));const h={template:({className:t,controls:e,pages:n,label:s,title:i})=>`\n\t\t<ul class="${t}">\n\t\t\t${n.map(((t,r)=>{const l={index:r,page:t,pages:n},o=s(l),a=i(l);return`<li>\n\t\t\t\t\t<button type="button" aria-controls="${e}" aria-label="${a}" title="${a}">\n\t\t\t\t\t\t<span>${o}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</li>`})).join("")}\n\t\t</ul>\n\t`,className:"pagination",label:({index:t})=>`${t+1}`,title:({index:t})=>`Go to ${t+1}. page`};class c{constructor(){window.addEventListener("resize",(()=>{s(this,"dims")}))}get dimensions(){return e(this,"dims",(()=>{const t=document.createElement("div"),e=document.createElement("div");document.body.appendChild(e),e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.appendChild(t),t.style.width="200px",t.style.height="100%",e.style.width="150px",e.style.height="200px",e.style.overflow="hidden";const n=t.offsetHeight;e.style.overflow="scroll";let s=t.offsetHeight;s=n===s?e.clientHeight:s;const i=n-s;return document.body.removeChild(e),{height:i}}))}}let d;const u={enabled:!0,className:"caroucssel-mask",tagName:"div"};class p{constructor(t={}){n(this,"conf",Object.assign(Object.assign({},u),t))}get name(){return"buildin:mask"}get el(){var t;return null!==(t=e(this,"mask"))&&void 0!==t?t:null}init(t){n(this,"prxy",t),d=null!=d?d:new c,this._render()}destroy(){this._remove(),i(this)}update(t){switch(t.type){case o.RESIZE:case o.FORCED:s(this,"hght"),this._render();break;default:this._render()}}_render(){const{enabled:t,className:s,tagName:i}=e(this,"conf");if(!t)return;const r=e(this,"prxy").el;let{height:l}=d.dimensions;r.scrollWidth<=r.clientWidth&&(l=0),e(this,"mask",(()=>{var t;const e=document.createElement(i);return e.className=s,e.style.overflow="hidden",e.style.height="100%",null===(t=r.parentNode)||void 0===t||t.insertBefore(e,r),e.appendChild(r),e}));l!==e(this,"hght")&&(n(this,"hght",l),r.style.height=`calc(100% + ${l}px)`,r.style.marginBottom=-1*l+"px")}_remove(){var t,n;const{el:s}=e(this,"prxy"),i=e(this,"mask");null===(t=null==i?void 0:i.parentNode)||void 0===t||t.insertBefore(s,i),null===(n=null==i?void 0:i.parentNode)||void 0===n||n.removeChild(i),s.removeAttribute("style")}}function g(t){return e(t,"inst")}class f{constructor(t,e){n(this,"inst",t),n(this,"feat",e)}get id(){return g(this).id}get el(){return g(this).el}get mask(){return g(this).mask}get index(){return g(this).index}set index(t){g(this).index=t}get items(){return g(this).items}get pages(){return g(this).pages}get pageIndex(){return g(this).pageIndex}update(t){var n;g(this).update(),(n=this,e(n,"feat")).forEach((e=>{e!==t&&e.update({type:o.FEATURE})}))}}function m(t,e){let n=null;return(...s)=>{null!==n&&clearTimeout(n),n=setTimeout((()=>t(...s)),e)}}const v=/^caroucssel-[0-9]*$/,x=/^(link|meta|noscript|script|style|title)$/i;let b=0;const y={features:[],filterItem:()=>!0,onScroll:()=>{}};exports.Buttons=class{constructor(t={}){n(this,"conf",Object.assign(Object.assign({},l),t)),this._onPrev=this._onPrev.bind(this),this._onNext=this._onNext.bind(this)}get name(){return"buildin:buttons"}init(t){n(this,"prxy",t),this._render()}destroy(){this._remove(),i(this)}update(){this._render()}_render(){const t=e(this,"prxy"),n=e(this,"conf"),{el:s,mask:i,pages:l,pageIndex:o}=t,[a,h]=e(this,"btns",(()=>{const t=null!=i?i:s,{template:e,className:l,previousClassName:o,previousLabel:a,previousTitle:h,nextClassName:c,nextLabel:d,nextTitle:u}=n;return[{controls:s.id,label:d,title:u,className:[l,c].join(" "),handler:this._onNext},{controls:s.id,label:a,title:h,className:[l,o].join(" "),handler:this._onPrev}].map((n=>{var s,{handler:i}=n,l=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]])}return n}(n,["handler"]);const o=r(e,l);return o?(o.addEventListener("click",i),null===(s=t.parentNode)||void 0===s||s.insertBefore(o,t.nextSibling),o):null}))}));if(a){const t=void 0===l[o+1];a.disabled=t}if(h){const t=void 0===l[o-1];h.disabled=t}}_remove(){e(this,"btns").forEach((t=>{var e;null==t||t.removeEventListener("click",this._onPrev),null==t||t.removeEventListener("click",this._onNext),null===(e=null==t?void 0:t.parentNode)||void 0===e||e.removeChild(t)}))}_onPrev(){const t=e(this,"prxy"),{pages:n,pageIndex:s}=t,i=n[s-1]||n[0];t.index=i}_onNext(){const t=e(this,"prxy"),{pages:n,pageIndex:s}=t,i=n[s+1]||n[n.length-1];t.index=i}},exports.Carousel=class{constructor(t,e={}){if(this.behavior=a.AUTO,!(t&&t instanceof Element))throw new Error(`Carousel needs a dom element but "${typeof t}" was passed.`);n(this,"element",t),b++,t.id=t.id||`caroucssel-${b}`,n(this,"id",t.id);const s=Object.assign(Object.assign({},y),e);n(this,"config",s);let i=null,r=[...s.features];const l=s.features.findIndex((t=>t instanceof p));l>-1&&([i]=r.splice(l,1)),null!=i||(i=new p),r=r.filter((t=>!(t instanceof p))),r=[i,...r],n(this,"mask",i);const o=new f(this,r);switch(n(this,"proxy",o),n(this,"feautres",r),r.forEach((t=>t.init(o))),!0){case Array.isArray(e.index):this.index=e.index;break;case!isNaN(e.index):this.index=[e.index]}this.behavior=a.SMOOTH,this._onScroll=m(this._onScroll.bind(this),25),this._onResize=m(this._onResize.bind(this),25),t.addEventListener("scroll",this._onScroll),window.addEventListener("resize",this._onResize)}static resetInstanceCount(){}get el(){return e(this,"element")}get mask(){var t;return null!==(t=e(this,"mask").el)&&void 0!==t?t:null}get id(){return e(this,"id")}get index(){return e(this,"index",(()=>{const{el:t,items:e}=this,{length:n}=e,{clientWidth:s}=t,i=t.getBoundingClientRect().left,r=[];let l=0;for(;l<n;l++){const t=e[l].getBoundingClientRect(),{width:n}=t;let{left:o}=t;o-=i,o+.25*n>=0&&o+.75*n<=s&&r.push(l)}return 0===r.length?[0]:r}))}set index(t){const{behavior:e,el:n,items:i}=this,{length:r}=i;if(!Array.isArray(t)||!t.length)return;let l=t[0]||0;l=Math.max(Math.min(l,r-1),0);const{scrollLeft:o}=n,a=o,h={left:i[l].offsetLeft};l===this.pages[0][0]&&(h.left=0),a!==h.left&&(s(this,"index"),n.scrollTo(Object.assign(Object.assign({},h),{behavior:e})))}get items(){return e(this,"items",(()=>{const{filterItem:t}=e(this,"config"),{el:n}=this;return Array.from(n.children).filter((t=>!x.test(t.tagName)&&!t.hidden)).filter(t)}))}get pages(){return e(this,"pages",(()=>{const{el:t,items:e}=this,{clientWidth:n}=t;if(0===n)return e.map(((t,e)=>[e]));let s=[[]];return e.map(((t,e)=>{const{offsetLeft:n,clientWidth:s}=t;return{left:n,width:s,item:t,index:e}})).sort(((t,e)=>t.left-e.left)).forEach((t=>{const{left:e,width:i}=t,r=s[s.length-1],l=r[0];let o=(null==l?void 0:l.left)||0;r===s[0]&&(o=0);let a=Math.floor((e-o+.75*i)/n);for(;a>0;)s.push([]),a--;s[s.length-1].push(t)})),s=s.filter((t=>0!==t.length)),s.map((t=>t.map((({index:t})=>t))))}))}get pageIndex(){return e(this,"page-index",(()=>{const{el:t,items:e,index:n,pages:s}=this,i=t.getBoundingClientRect().left,{clientWidth:r}=t;let l=n.reduce(((t,n)=>{if(!e[n])return t;let{left:s,right:l}=e[n].getBoundingClientRect();return s=Math.round(s-i),l=Math.round(l-i),s<0||r<l?t:t.concat([n])}),[]);0===l.length&&(l=[n[0]]);const o=l.sort(((t,n)=>{const s=e[t].getBoundingClientRect().right;return e[n].getBoundingClientRect().right-s}))[0];return s.findIndex((t=>t.includes(o)))}))}destroy(){const{el:t}=this;v.test(t.id)&&t.removeAttribute("id");e(this,"feautres").forEach((t=>t.destroy())),t.removeEventListener("scroll",this._onScroll),window.removeEventListener("resize",this._onResize),i(this)}update(){s(this,"index"),s(this,"items"),s(this,"pages"),s(this,"page-index");e(this,"feautres").forEach((t=>t.update({type:o.FORCED})))}_onScroll(t){s(this,"index"),s(this,"page-index");e(this,"feautres").forEach((t=>t.update({type:o.SCROLL})));const{index:n}=this;e(this,"config").onScroll({index:n,type:"scroll",target:this,originalEvent:t})}_onResize(){s(this,"pages"),s(this,"index"),s(this,"page-index");e(this,"feautres").forEach((t=>t.update({type:o.RESIZE})))}},exports.Mask=p,exports.Pagination=class{constructor(t={}){n(this,"conf",Object.assign(Object.assign({},h),t)),this._onClick=this._onClick.bind(this)}get name(){return"buildin:pagination"}init(t){n(this,"prxy",t),this._add()}destroy(){this._remove(),i(this)}update(t){switch(t.type){case o.SCROLL:this._update();break;default:this._remove(),this._add()}}_add(){var t;const s=e(this,"prxy"),i=e(this,"conf"),{el:l,mask:o,pages:a}=s,h=null!=o?o:l;if(a.length<2)return;const{template:c,className:d,label:u,title:p}=i,g=r(c,{label:u,title:p,pages:a,className:d,controls:l.id});if(!g)return;const f=Array.from(g.querySelectorAll("button")).map((t=>(t.addEventListener("click",this._onClick,!0),t)));null===(t=h.parentNode)||void 0===t||t.appendChild(g),n(this,"pags",g),n(this,"btns",f),this._update()}_update(){const t=e(this,"prxy"),n=e(this,"btns"),{pageIndex:s}=t;n.forEach(((t,e)=>t.disabled=e===s))}_remove(){var t;const n=e(this,"pags"),i=e(this,"btns");null==i||i.forEach((t=>{var e;t.removeEventListener("click",this._onClick),null===(e=t.parentNode)||void 0===e||e.removeChild(t)})),null===(t=null==n?void 0:n.parentNode)||void 0===t||t.removeChild(n),s(this,"btns"),s(this,"pags")}_onClick(t){const n=e(this,"prxy"),s=e(this,"btns"),i=t.currentTarget,r=s.indexOf(i);n.index=n.pages[r]}},exports.version="0.12.0-3";
