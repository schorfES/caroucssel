"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=new WeakMap;function e(e,n,s){const i=t.get(e)||{};if(n in i)return i[n];if(!s)return;const o=s();return i[n]=o,t.set(e,i),o}function n(e,n,s){const i=t.get(e)||{};i[n]=s,t.set(e,i)}function s(e,n){const s=t.get(e);s&&(s[n]=void 0,delete s[n])}function i(e){t.delete(e)}function o(t,e){const n=document.createElement("div");n.innerHTML=t(e);const s=n.firstElementChild;return s||null}const r={template:({className:t,controls:e,label:n,title:s})=>`\n\t\t<button type="button" class="${t}" aria-label="${n}" title="${s}" aria-controls="${e}">\n\t\t\t<span>${n}</span>\n\t\t</button>\n\t`,className:"button",nextClassName:"is-next",nextLabel:"Next",nextTitle:"Go to next",previousClassName:"is-previous",previousLabel:"Previous",previousTitle:"Go to previous"};var l,a;exports.UpdateReason=void 0,(l=exports.UpdateReason||(exports.UpdateReason={})).SCROLL="scroll",l.RESIZE="resize",l.FORCED="forced",l.PLUGIN="plugin",exports.ScrollBehavior=void 0,(a=exports.ScrollBehavior||(exports.ScrollBehavior={})).AUTO="auto",a.SMOOTH="smooth";class c{constructor(){window.addEventListener("resize",(()=>{s(this,"dimensions")}))}get dimensions(){return e(this,"dimensions",(()=>{const t=document.createElement("div"),e=document.createElement("div");document.body.appendChild(e),e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.appendChild(t),t.style.width="200px",t.style.height="100%",e.style.width="150px",e.style.height="200px",e.style.overflow="hidden";const n=t.offsetHeight;e.style.overflow="scroll";let s=t.offsetHeight;s=n===s?e.clientHeight:s;const i=n-s;return document.body.removeChild(e),{height:i}}))}}let d;const h={enabled:!0};class u{constructor(t={}){n(this,"config",Object.assign(Object.assign({},h),t))}get name(){return"buildin:mask"}get el(){var t;return null!==(t=e(this,"mask"))&&void 0!==t?t:null}init(t){n(this,"proxy",t),d=d||new c,this._render()}destroy(){this._remove(),i(this)}update(t){switch(t.reason){case exports.UpdateReason.RESIZE:case exports.UpdateReason.FORCED:s(this,"scrollbar"),this._render();break;default:this._render()}}_render(){const{enabled:t}=e(this,"config");if(!t)return;const s=e(this,"proxy").el;let{height:i}=d.dimensions;s.scrollWidth<=s.clientWidth&&(i=0),e(this,"mask",(()=>{var t;const e=document.createElement("div");return e.className="caroucssel-mask",e.style.overflow="hidden",e.style.height="100%",null===(t=s.parentNode)||void 0===t||t.insertBefore(e,s),e.appendChild(s),e}));i!==e(this,"scrollbar")&&(n(this,"scrollbar",i),s.style.height=`calc(100% + ${i}px)`,s.style.marginBottom=-1*i+"px")}_remove(){var t,n;const{el:s}=e(this,"proxy"),i=e(this,"mask");null===(t=null==i?void 0:i.parentNode)||void 0===t||t.insertBefore(s,i),null===(n=null==i?void 0:i.parentNode)||void 0===n||n.removeChild(i),s.removeAttribute("style")}}const p={template:({className:t,controls:e,pages:n,label:s,title:i})=>`\n\t\t<ul class="${t}">\n\t\t\t${n.map(((t,o)=>{const r={index:o,page:t,pages:n},l=s(r),a=i(r);return`<li>\n\t\t\t\t\t<button type="button" aria-controls="${e}" aria-label="${a}" title="${a}">\n\t\t\t\t\t\t<span>${l}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</li>`})).join("")}\n\t\t</ul>\n\t`,className:"pagination",label:({index:t})=>`${t+1}`,title:({index:t})=>`Go to ${t+1}. page`};function g(t,e){let n=null;return(...s)=>{null!==n&&clearTimeout(n),n=setTimeout((()=>t(...s)),e)}}const m=/^caroucssel-[0-9]*$/,x=/^(link|meta|noscript|script|style|title)$/i,v={plugins:[],filterItem:()=>!0,onScroll:()=>{}};let f=0;class b{constructor(t,e){n(this,"proxy:instance",t),n(this,"proxy:plugins",e)}get el(){return e(this,"proxy:instance").el}get mask(){return e(this,"proxy:instance").mask}get index(){return e(this,"proxy:instance").index}set index(t){e(this,"proxy:instance").index=t}get items(){return e(this,"proxy:instance").items}get pages(){return e(this,"proxy:instance").pages}get pageIndex(){return e(this,"proxy:instance").pageIndex}update(t){}}exports.Buttons=class{constructor(t={}){n(this,"config",Object.assign(Object.assign({},r),t)),this._onPrevious=this._onPrevious.bind(this),this._onNext=this._onNext.bind(this)}get name(){return"buildin:buttons"}init(t){n(this,"proxy",t),this._render()}destroy(){this._remove(),i(this)}update(){this._render()}_render(){const t=e(this,"proxy"),n=e(this,"config"),{el:s,mask:i,pages:r,pageIndex:l}=t,a=null!=i?i:s,{template:c,className:d,previousClassName:h,previousLabel:u,previousTitle:p,nextClassName:g,nextLabel:m,nextTitle:x}=n,v=[{controls:s.id,label:m,title:x,className:[d,g].join(" "),handler:this._onNext},{controls:s.id,label:u,title:p,className:[d,h].join(" "),handler:this._onPrevious}],[f,b]=e(this,"buttons",(()=>v.map((t=>{var e,{handler:n}=t,s=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]])}return n}(t,["handler"]);const i=o(c,s);return i?(i.addEventListener("click",n),null===(e=a.parentNode)||void 0===e||e.insertBefore(i,a.nextSibling),i):null}))));if(f){const t=void 0===r[l+1];f.disabled=t}if(b){const t=void 0===r[l-1];b.disabled=t}}_remove(){const t=e(this,"buttons");t&&t.forEach((t=>{var e;null==t||t.removeEventListener("click",this._onPrevious),null==t||t.removeEventListener("click",this._onNext),null===(e=null==t?void 0:t.parentNode)||void 0===e||e.removeChild(t)}))}_onPrevious(){const t=e(this,"proxy"),{pages:n,pageIndex:s}=t,i=n[s-1]||n[0];t.index=i}_onNext(){const t=e(this,"proxy"),{pages:n,pageIndex:s}=t,i=n[s+1]||n[n.length-1];t.index=i}},exports.Carousel=class{constructor(t,e={}){if(this.behavior=exports.ScrollBehavior.AUTO,!(t&&t instanceof Element))throw new Error(`Carousel needs a dom element but "${typeof t}" was passed.`);n(this,"element",t),f++,t.id=t.id||`caroucssel-${f}`,n(this,"id",t.id);const s=Object.assign(Object.assign({},v),e);n(this,"config",s);const i=[...s.plugins],o=s.plugins.findIndex((t=>t instanceof u));let r=new u;o>-1&&([r]=i.splice(o,1)),i.unshift(r),n(this,"mask",r);const l=new b(this,i);switch(n(this,"proxy",l),n(this,"plugins",i),i.forEach((t=>t.init(l))),!0){case Array.isArray(e.index):this.index=e.index;break;case!isNaN(e.index):this.index=[e.index]}this.behavior=exports.ScrollBehavior.SMOOTH,this._onScroll=g(this._onScroll.bind(this),25),this._onResize=g(this._onResize.bind(this),25),t.addEventListener("scroll",this._onScroll),window.addEventListener("resize",this._onResize)}static resetInstanceCount(){}get el(){return e(this,"element")}get mask(){var t;return null!==(t=e(this,"mask").el)&&void 0!==t?t:null}get id(){return e(this,"id")}get index(){return e(this,"index",(()=>{const{el:t,items:e}=this,{length:n}=e,{clientWidth:s}=t,i=t.getBoundingClientRect().left,o=[];let r=0;for(;r<n;r++){const t=e[r].getBoundingClientRect(),{width:n}=t;let{left:l}=t;l-=i,l+.25*n>=0&&l+.75*n<=s&&o.push(r)}return 0===o.length?[0]:o}))}set index(t){const{behavior:e,el:n,items:i}=this,{length:o}=i;if(!Array.isArray(t)||!t.length)return;if(0===o)return;let r=t[0]||0;r=Math.max(Math.min(r,o-1),0);const{scrollLeft:l}=n,a=l,c={left:i[r].offsetLeft};r===this.pages[0][0]&&(c.left=0),a!==c.left&&(s(this,"index"),n.scrollTo(Object.assign(Object.assign({},c),{behavior:e})))}get items(){return e(this,"items",(()=>{const{filterItem:t}=e(this,"config"),{el:n}=this;return Array.from(n.children).filter((t=>!x.test(t.tagName)&&!t.hidden)).filter(t)}))}get pages(){return e(this,"pages",(()=>{const{el:t,items:e}=this,{clientWidth:n}=t;if(0===n)return e.map(((t,e)=>[e]));let s=[[]];return e.map(((t,e)=>{const{offsetLeft:n,clientWidth:s}=t;return{left:n,width:s,item:t,index:e}})).sort(((t,e)=>t.left-e.left)).forEach((t=>{const{left:e,width:i}=t,o=s[s.length-1],r=o[0];let l=(null==r?void 0:r.left)||0;o===s[0]&&(l=0);let a=Math.floor((e-l+.75*i)/n);for(;a>0;)s.push([]),a--;s[s.length-1].push(t)})),s=s.filter((t=>0!==t.length)),s.map((t=>t.map((({index:t})=>t))))}))}get pageIndex(){return e(this,"page-index",(()=>{const{el:t,items:e,index:n,pages:s}=this,i=t.getBoundingClientRect().left,{clientWidth:o}=t;let r=n.reduce(((t,n)=>{if(!e[n])return t;let{left:s,right:r}=e[n].getBoundingClientRect();return s=Math.round(s-i),r=Math.round(r-i),s<0||o<r?t:t.concat([n])}),[]);0===r.length&&(r=[n[0]]);const l=r.sort(((t,n)=>{const s=e[t].getBoundingClientRect().right;return e[n].getBoundingClientRect().right-s}))[0];return s.findIndex((t=>t.includes(l)))}))}destroy(){const{el:t}=this;m.test(t.id)&&t.removeAttribute("id");const n=e(this,"plugins");null==n||n.forEach((t=>t.destroy())),t.removeEventListener("scroll",this._onScroll),window.removeEventListener("resize",this._onResize),i(this)}update(){s(this,"index"),s(this,"items"),s(this,"pages"),s(this,"page-index");const t=e(this,"plugins");null==t||t.forEach((t=>t.update({reason:exports.UpdateReason.FORCED})))}_onScroll(t){s(this,"index"),s(this,"page-index");const n=e(this,"plugins");null==n||n.forEach((t=>t.update({reason:exports.UpdateReason.SCROLL})));const{index:i}=this,o=e(this,"config");null==o||o.onScroll({index:i,type:"scroll",target:this,originalEvent:t})}_onResize(){s(this,"pages"),s(this,"index"),s(this,"page-index");const t=e(this,"plugins");null==t||t.forEach((t=>t.update({reason:exports.UpdateReason.RESIZE})))}},exports.Mask=u,exports.Mouse=class{get name(){return"buildin:mouse"}init(t){n(this,"proxy",t)}destroy(){console.log("Destroy mouse")}update(t){console.log("Update mouse:",t.reason)}},exports.Pagination=class{constructor(t={}){n(this,"config",Object.assign(Object.assign({},p),t)),this._onClick=this._onClick.bind(this)}get name(){return"buildin:pagination"}init(t){n(this,"proxy",t),this._add()}destroy(){this._remove(),i(this)}update(t){switch(t.reason){case exports.UpdateReason.SCROLL:this._update();break;default:this._remove(),this._add()}}_add(){var t;const s=e(this,"proxy"),i=e(this,"config"),{el:r,mask:l,pages:a}=s,c=null!=l?l:r;if(a.length<2)return;const{template:d,className:h,label:u,title:p}=i,g=o(d,{label:u,title:p,pages:a,className:h,controls:r.id});if(!g)return;const m=Array.from(g.querySelectorAll("button")).map((t=>(t.addEventListener("click",this._onClick,!0),t)));null===(t=c.parentNode)||void 0===t||t.appendChild(g),n(this,"pagination",g),n(this,"buttons",m),this._update()}_update(){const t=e(this,"proxy"),n=e(this,"buttons"),{pageIndex:s}=t;null==n||n.forEach(((t,e)=>t.disabled=e===s))}_remove(){var t;const n=e(this,"pagination"),i=e(this,"buttons");null==i||i.forEach((t=>{var e;t.removeEventListener("click",this._onClick),null===(e=t.parentNode)||void 0===e||e.removeChild(t)})),null===(t=null==n?void 0:n.parentNode)||void 0===t||t.removeChild(n),s(this,"buttons"),s(this,"pagination")}_onClick(t){var n;const s=e(this,"proxy"),i=e(this,"buttons"),o=t.currentTarget,r=null!==(n=null==i?void 0:i.indexOf(o))&&void 0!==n?n:0;s.index=s.pages[r]}};
